# 우산 대여 키오스크 시스템 구현 계획서

## 1. 프로젝트 개요

본 문서는 "우산 대여 키오스크 시스템 요구사항 명세서(SRS.md)"를 기반으로 실제 개발을 위한 단계별 구현 계획을 정의합니다.

### 1.1. 기술 스택
- **Containerization**: Docker Compose
- **Frontend**: React.js
- **Web Server / Proxy**: Nginx Proxy Manager
- **Backend API Server**: Node.js (Express.js)
- **Database**: PostgreSQL
- **File/Image Storage**: Minio

### 1.2. 아키텍처
- 모든 서비스(Frontend, Backend, DB, Storage, Proxy)는 Docker Compose를 통해 단일 환경에서 관리됩니다.
- Nginx는 웹 서버 역할을 하며, 프론트엔드 정적 파일을 서빙하고 백엔드 API 서버로 요청을 프록시합니다.
- React는 사용자 인터페이스를 구현합니다.
- Node.js는 비즈니스 로직과 API를 처리합니다.
- PostgreSQL은 사용자 정보, 우산 상태, 대여/반납 기록 등 모든 데이터를 저장합니다.
- Minio는 시스템에 필요한 이미지(예: 서비스 대표 이미지)나 기타 파일을 저장합니다.

---

## 2. 개발 단계별 계획 (Step-by-Step)

### **Step 0: 개발 환경 및 Docker Compose 설정**

이 단계는 프로젝트의 기반을 설정하는 가장 중요한 과정입니다.

- **Task**:
    1.  프로젝트 루트에 `docker-compose.yml` 파일 생성.
    2.  `docker-compose.yml`에 `nginx`, `frontend`, `backend`, `db`(PostgreSQL), `minio` 서비스 정의.
        - `nginx`: React 빌드 파일을 서빙하고, `/api` 경로의 요청을 `backend` 서비스로 프록시하도록 설정.
        - `frontend`: React 개발 서버 설정. `create-react-app`을 사용하여 초기 프로젝트 생성.
        - `backend`: Node.js + Express 개발 환경 설정.
        - `db`: PostgreSQL 서비스 설정. 데이터 영속성을 위해 Docker 볼륨 마운트.
        - `minio`: Minio 서비스 설정. 데이터 및 설정 영속성을 위해 Docker 볼륨 마운트.
    3.  Backend에서 PostgreSQL, Minio와 연결하기 위한 기본 설정 추가.
    4.  DB 초기화를 위한 SQL 스크립트 작성 (`umbrellas`, `rentals` 테이블 등).

- **Test Case**:
    - `docker-compose up --build` 명령 실행 시 모든 컨테이너가 오류 없이 정상적으로 실행되는지 확인.
    - 웹 브라우저에서 `localhost` 접속 시 React 초기 화면이 표시되는지 확인.
    - `backend`에서 `db` 및 `minio` 서비스와 성공적으로 연결되는지 로그를 통해 확인.

- **Success Criteria**:
    - 모든 Docker 컨테이너가 실행 상태(`running`)를 유지한다.
    - 각 서비스 간 네트워크 통신이 정상적으로 이루어진다.
    - 데이터베이스 테이블이 초기 스크립트에 따라 정상적으로 생성된다.

---

### **Step 1: 인덱스 페이지 (Index Page) 구현**

- **Task**:
    1.  **Frontend**:
        - `src/pages/IndexPage.js` 컴포넌트 생성.
        - 화면 전체를 차지하는 서비스 대표 이미지와 텍스트를 표시.
        - 화면 아무 곳이나 터치하면 `/home` (사용자 홈)으로 이동하는 이벤트 핸들러 추가.
        - 화면의 특정 영역(예: 우측 상단 모서리를 5초간 누르기)을 터치하면 `/admin` (관리자 페이지)으로 이동하는 숨겨진 기능 구현.
    2.  **Backend**:
        - 인터넷 연결 상태나 서버 상태를 확인할 수 있는 Health Check API (`GET /api/health`) 구현.
    3.  **Frontend**:
        - 주기적으로 Health Check API를 호출하여 서비스 접속 오류 발생 시, 오류 메시지를 화면에 표시하는 로직 구현.

- **Test Case**:
    - **TC 1.1**: 키오스크 첫 화면에 접속했을 때, 대표 이미지와 텍스트가 표시되는가?
    - **TC 1.2**: 화면의 아무 곳이나 터치했을 때, 사용자 홈 페이지로 이동하는가?
    - **TC 1.3**: 숨겨진 관리자 페이지 진입 제스처를 수행했을 때, 관리자 페이지로 이동하는가?
    - **TC 1.4**: 백엔드 서버를 중지시켰을 때, "서비스 접속 오류" 메시지가 표시되는가?

- **Success Criteria**:
    - SRS 1. 인덱스 페이지의 모든 요구사항(기능, UI/UX, 예외 처리)을 충족한다.
    - 페이지 라우팅이 정상적으로 동작한다.

---

### **Step 2: 사용자 홈 (User Home) 및 기본 레이아웃 구현**

- **Task**:
    1.  **Frontend**:
        - `src/pages/UserHomePage.js` 컴포넌트 생성.
        - '대여', '반납', '분실 신고', '고장 신고' 4개의 기능 버튼을 수직으로 나열.
        - 각 버튼은 충분한 크기와 간격을 가지도록 CSS 스타일링.
        - 각 버튼 터치 시 해당 기능 페이지로 이동하도록 라우팅 설정.
        - 모든 페이지에서 사용할 `Header` (뒤로 가기 버튼 포함) 및 `Footer` 컴포넌트 등 기본 레이아웃 구현.

- **Test Case**:
    - **TC 2.1**: '대여' 버튼 터치 시 대여 페이지로 이동하는가?
    - **TC 2.2**: '반납' 버튼 터치 시 반납 페이지로 이동하는가?
    - **TC 2.3**: '분실 신고' 버튼 터치 시 분실 신고 페이지로 이동하는가?
    - **TC 2.4**: '고장 신고' 버튼 터치 시 고장 신고 페이지로 이동하는가?

- **Success Criteria**:
    - SRS 2.1. 사용자 홈의 모든 요구사항을 충족한다.
    - 4개의 주요 기능으로의 내비게이션이 원활하게 동작한다.

---

### **Step 3: 대여 (Borrow) 기능 구현**

- **Task**:
    1.  **Database**:
        - `rentals` 테이블에 `user_phone`, `user_password`, `umbrella_id`, `rental_time`, `status` 컬럼 정의.
        - `umbrellas` 테이블에 `id`, `type` (장우산/단우산), `status` (대여 가능/대여 중/분실/고장) 컬럼 정의.
    2.  **Backend**:
        - `POST /api/rentals`: 대여 요청을 처리하는 API 구현.
            - 요청 데이터(전화번호, 비밀번호) 유효성 검사.
            - 선택한 종류의 '대여 가능' 우산 조회.
            - 재고가 없을 경우 404 에러 반환.
            - `rentals` 테이블에 대여 정보 기록.
            - `umbrellas` 테이블의 우산 상태를 '대여 중'으로 업데이트.
            - 대여된 우산 정보를 응답으로 반환.
    3.  **Frontend**:
        - `src/pages/BorrowPage.js` 컴포넌트 생성.
        - **1단계 (사용자 정보 등록)**: 전화번호, 일회용 비밀번호, 비밀번호 확인 입력 폼 구현.
            - 입력값 누락, 비밀번호 불일치 시 오류 메시지 표시.
        - **2단계 (우산 종류 선택)**: '장우산', '단우산' 선택 버튼 구현.
        - **3단계 (대여 실행 및 완료)**:
            - 백엔드에 대여 요청 API 호출.
            - 재고 없음, 프로세스 오류 등 예외 상황에 대한 메시지 처리.
            - 성공 시, 대여된 우산 정보와 '대여 완료' 메시지 표시.

- **Test Case**:
    - **TC 3.1**: 모든 정보를 입력하지 않고 '다음' 버튼 터치 시 "모든 정보를 입력해주세요" 메시지가 표시되는가?
    - **TC 3.2**: 비밀번호와 비밀번호 확인이 다를 경우 "일회용 비밀번호가 틀렸습니다" 메시지가 표시되는가?
    - **TC 3.3**: 특정 종류의 우산 재고가 없을 때 선택 시 "선택하신 우산 종류가 모두 대여중입니다" 메시지가 표시되는가?
    - **TC 3.4**: 모든 절차를 정상적으로 완료했을 때, '대여 완료' 메시지와 우산 정보가 표시되고 DB 상태가 '대여 중'으로 변경되는가?

- **Success Criteria**:
    - SRS 2.2. 대여의 모든 요구사항을 충족한다.
    - 사용자는 성공적으로 우산을 대여하고, 데이터베이스에 해당 기록이 정확히 남는다.

---

### **Step 4: 반납 (Return) 기능 구현**

- **Task**:
    1.  **Backend**:
        - `PUT /api/rentals/return`: 반납 요청을 처리하는 API 구현.
            - 전화번호와 비밀번호로 '대여 중'인 대여 정보를 조회.
            - 일치하는 정보가 없으면 404 에러 반환.
            - `rentals` 테이블의 상태를 '반납 완료'로 업데이트.
            - `umbrellas` 테이블의 우산 상태를 '대여 가능'으로 업데이트.
    2.  **Frontend**:
        - `src/pages/ReturnPage.js` 컴포넌트 생성.
        - 전화번호, 일회용 비밀번호 입력 폼 구현.
        - '반납' 버튼 터치 시 백엔드에 반납 요청 API 호출.
        - 대여 정보 불일치, 프로세스 오류 등 예외 상황에 대한 메시지 처리.
        - 성공 시, '반납 완료' 메시지를 명확하게 표시.

- **Test Case**:
    - **TC 4.1**: 잘못된 사용자 정보 입력 시 "일치하는 대여 정보가 없습니다" 메시지가 표시되는가?
    - **TC 4.2**: 올바른 사용자 정보 입력 후 '반납' 버튼 터치 시, '반납 완료' 메시지가 표시되는가?
    - **TC 4.3**: 반납 완료 후, DB에서 해당 우산의 상태가 '대여 가능'으로 변경되는가?

- **Success Criteria**:
    - SRS 2.3. 반납의 모든 요구사항을 충족한다.
    - 사용자는 성공적으로 우산을 반납하고, 데이터베이스의 우산 상태가 정확히 업데이트된다.

---

### **Step 5: 분실 신고 (Loss Report) 기능 구현**

- **Task**:
    1.  **Backend**:
        - `PUT /api/rentals/report-loss`: 분실 신고 요청을 처리하는 API 구현.
            - 전화번호와 비밀번호로 '대여 중'인 대여 정보를 조회.
            - 일치하는 정보가 없으면 404 에러 반환.
            - `rentals` 테이블의 상태를 '분실'로 업데이트.
            - `umbrellas` 테이블의 우산 상태를 '분실'로 업데이트.
    2.  **Frontend**:
        - `src/pages/LossReportPage.js` 컴포넌트 생성. (반납 페이지와 UI/로직이 유사하므로 컴포넌트 재사용 고려)
        - 전화번호, 일회용 비밀번호 입력 폼 구현.
        - '분실 신고' 버튼 터치 시 백엔드에 분실 신고 API 호출.
        - 예외 처리(정보 불일치 등) 및 성공 시 '신고 완료' 메시지 표시.

- **Test Case**:
    - **TC 5.1**: 잘못된 사용자 정보 입력 시 "일치하는 대여 정보가 없습니다" 메시지가 표시되는가?
    - **TC 5.2**: 올바른 사용자 정보 입력 후 '분실 신고' 버튼 터치 시, '신고 완료' 메시지가 표시되는가?
    - **TC 5.3**: 신고 완료 후, DB에서 해당 우산의 상태가 '분실'로 변경되는가?

- **Success Criteria**:
    - SRS 2.4. 분실 신고의 모든 요구사항을 충족한다.
    - 분실된 우산의 상태가 데이터베이스에 정확히 반영된다.

---

### **Step 6: 고장 신고 (Defect Report) 기능 구현**

- **Task**:
    1.  **Backend**:
        - `PUT /api/umbrellas/:umbrellaId/report-defect`: 고장 신고를 처리하는 API 구현.
            - `:umbrellaId`로 우산 존재 여부 확인.
            - 존재하지 않으면 404 에러 반환.
            - `umbrellas` 테이블의 우산 상태를 '고장'으로 업데이트.
    2.  **Frontend**:
        - `src/pages/DefectReportPage.js` 컴포넌트 생성.
        - 우산 고유 번호를 입력하는 폼 구현.
        - '고장 신고' 버튼 터치 시 백엔드에 고장 신고 API 호출.
        - 예외 처리(존재하지 않는 우산 번호 등) 및 성공 시 '고장 신고 완료' 메시지 표시.

- **Test Case**:
    - **TC 6.1**: 존재하지 않는 우산 번호 입력 시 "존재하지 않는 우산 번호입니다" 메시지가 표시되는가?
    - **TC 6.2**: 올바른 우산 번호 입력 후 '고장 신고' 버튼 터치 시, '고장 신고에 성공했습니다' 메시지가 표시되는가?
    - **TC 6.3**: 신고 완료 후, DB에서 해당 우산의 상태가 '고장'으로 변경되는가?

- **Success Criteria**:
    - SRS 2.5. 고장 신고의 모든 요구사항을 충족한다.
    - 고장 난 우산의 상태가 데이터베이스에 정확히 반영된다.

---

### **Step 7: 관리자 페이지 (Admin Page) 기본 기능 구현**

- **Task**:
    1.  **Backend**:
        - `GET /api/admin/umbrellas`: 전체 우산 목록과 상태를 조회하는 API 구현.
        - `GET /api/admin/rentals`: 전체 대여/반납/분실 기록을 조회하는 API 구현.
        - (Optional) 관리자 인증을 위한 간단한 로그인 기능 구현.
    2.  **Frontend**:
        - `src/pages/AdminPage.js` 컴포넌트 생성.
        - 우산 현황(전체, 대여 가능, 대여 중, 분실, 고장)을 표나 리스트 형태로 표시.
        - 대여 기록을 최신순으로 표시.
    3.  **Minio/Nginx 연동**:
        - 관리자 페이지에서 인덱스 페이지의 대표 이미지를 업로드하고 변경할 수 있는 기능 구현.
        - Backend에 파일 업로드 API (`POST /api/admin/upload-image`) 구현 (Multer, Minio SDK 사용).

- **Test Case**:
    - **TC 7.1**: 관리자 페이지 접근 시, 전체 우산 현황이 정확히 표시되는가?
    - **TC 7.2**: 새로운 이미지를 업로드했을 때, Minio에 파일이 저장되고 인덱스 페이지의 이미지가 변경되는가?

- **Success Criteria**:
    - 관리자가 시스템의 현재 상태(우산, 대여 기록)를 한눈에 파악할 수 있다.
    - 기본적인 시스템 설정(대표 이미지)을 변경할 수 있다.
